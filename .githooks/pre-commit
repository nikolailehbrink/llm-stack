#!/bin/sh
# Pre-commit: auto-format staged files, then run lint and knip checks

# Get staged files (added, copied, modified, renamed)
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR)

if [ -n "$STAGED_FILES" ]; then
  echo "Formatting staged files..."
  echo "$STAGED_FILES" | xargs bun run fmt

  # Re-stage the formatted files
  echo "$STAGED_FILES" | xargs git add
fi

echo "Running linter..."
bun run lint || {
  echo "Lint errors found. Run 'bun run lint:fix' to fix."
  exit 1
}

echo "Running knip..."
bun run knip || {
  echo "Unused code detected. Run 'bun run knip' for details."
  exit 1
}
